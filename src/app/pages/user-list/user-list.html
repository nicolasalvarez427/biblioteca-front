<div class="container">
  <div class="card card-glass shadow-lg position-relative">
    
    <span class="badge bg-light text-dark border fs-6 px-3 py-2 rounded-pill shadow-sm position-absolute top-0 end-0 m-3">
       Total: {{ users().length }}
    </span>

    <div class="card-header bg-transparent border-0 pt-4 px-4 pb-3">
      <div class="text-center">
        <h2 class="fw-bold text-primary mb-0 d-inline-flex align-items-center gap-2">
          üë• Gesti√≥n de Usuarios
        </h2>
        <p class="text-muted mb-0 mt-1">Administra las cuentas registradas en la plataforma.</p>
      </div>
    </div>

    <div class="card-body p-4">
      @if (isLoading()) {
        <div class="text-center py-5 my-3 text-muted">
          <div class="spinner-border text-primary mb-3" role="status"></div>
          <p>Cargando usuarios...</p>
        </div>
      } @else {
        @if (users().length > 0) {
          <div class="table-responsive rounded-4 shadow-sm bg-white">
            <table class="table table-hover mb-0 align-middle">
              <thead class="table-light text-center">
                <tr>
                  <th class="py-3">Usuario</th>
                  <th class="py-3">Email</th>
                  <th class="py-3">Rol</th>
                  <th class="py-3 text-start ps-4">Pr√©stamos Activos</th>
                  <th class="py-3">Acciones</th>
                </tr>
              </thead>
              <tbody>
                @for (user of users(); track user._id) {
                  <tr class="text-center">
                    <td class="fw-semibold">{{ user.username }}</td>
                    <td class="text-muted">{{ user.email }}</td>
                    <td>
                      <span class="badge rounded-pill badge-role"
                            [ngClass]="{
                              'bg-warning text-dark': user.role === 'Administrador',
                              'bg-info text-dark': user.role === 'Estudiante'
                            }">
                        {{ user.role }}
                      </span>
                    </td>
                    <td class="text-start ps-4">
                      @if (user.librosPrestados && user.librosPrestados.length > 0) {
                        <ul class="book-list mb-0">
                          
                          @for (libro of user.librosPrestados; track libro._id) {
                            <li title="{{ libro.titulo }}">
                              <span class="book-icon small">üìò</span>
                              <span class="book-title">{{ libro.titulo }}</span>
                              <button 
                                class="btn btn-outline-primary btn-sm btn-devolver"
                                (click)="onDevolver(libro._id, libro.titulo, user.username)"
                                title="Forzar devoluci√≥n de este libro">
                                Devolver
                              </button>
                            </li>
                          }
                        </ul>
                      } @else {
                        <span class="badge rounded-pill no-loans-badge px-3">Sin pr√©stamos</span>
                      }
                    </td>
                    <td>
                      <button class="btn btn-outline-danger btn-sm fw-semibold btn-delete"
                              (click)="onDelete(user._id, user.username)"
                              title="Eliminar permanentemente a este usuario">
                        üóëÔ∏è Eliminar
                      </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <div class="alert alert-warning text-center p-4 border-0 bg-warning-subtle text-warning-emphasis rounded-4">
             No hay usuarios registrados adem√°s de ti.
          </div>
        }
      }
    </div>
  </div>
</div>